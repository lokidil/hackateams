!function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=4)}([function(e,t){e.exports=require("express-msteams-host")},function(e,t){e.exports=require("debug")},function(e,t){e.exports=require("botbuilder")},function(e,t){e.exports=require("botbuilder-dialogs")},function(e,t,o){e.exports=o(5)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(6),r=o(7),i=o(8),s=o(9),c=o(0),a=o(1)("msteams");a("Initializing Microsoft Teams Express hosted App..."),o(10).config();const u=o(11),l=n(),d=process.env.port||process.env.PORT||3007;l.use(n.json({verify:(e,t,o,n)=>{e.rawBody=o.toString()}})),l.use(n.urlencoded({extended:!0})),l.set("views",i.join(__dirname,"/")),l.use(s("tiny")),l.use("/scripts",n.static(i.join(__dirname,"web/scripts"))),l.use("/assets",n.static(i.join(__dirname,"web/assets"))),l.use(c.MsTeamsApiRouter(u)),l.use(c.MsTeamsPageRouter({root:i.join(__dirname,"web/"),components:u})),l.use("/",n.static(i.join(__dirname,"web/"),{index:"index.html"})),l.set("port",d),r.createServer(l).listen(d,()=>{a(`Server running on ${d}`)})},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=require("dotenv")},function(e,t,o){"use strict";function n(e){for(var o in e)t.hasOwnProperty(o)||(t[o]=e[o])}Object.defineProperty(t,"__esModule",{value:!0}),t.nonce={},n(o(12)),n(o(13)),n(o(19)),n(o(21))},function(e,t,o){"use strict";var n=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(t,"__esModule",{value:!0});const r=o(0);let i=class{};i=n([r.PreventIframe("/csrDemoTab/index.html"),r.PreventIframe("/csrDemoTab/config.html"),r.PreventIframe("/csrDemoTab/remove.html")],i),t.CsrDemoTab=i},function(e,t,o){"use strict";var n=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s},r=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function s(e){try{a(n.next(e))}catch(e){i(e)}}function c(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){e.done?r(e.value):new o((function(t){t(e.value)})).then(s,c)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=o(0),s=o(1),c=o(3),a=o(2),u=o(14),l=o(15),d=o(17),p=o(18);s("msteams");let f=class{constructor(e){this.activityProc=new p.TeamsActivityProcessor,this._csrDemoMessageExtension=new d.default,this.conversationState=e,this.dialogState=e.createProperty("dialogState"),this.dialogs=new c.DialogSet(this.dialogState),this.dialogs.add(new u.default("help")),this.activityProc.messageActivityHandler={onMessage:e=>r(this,void 0,void 0,(function*(){const t=p.TeamsContext.from(e);switch(e.activity.type){case a.ActivityTypes.Message:const o=t?t.getActivityTextWithoutMentions().toLowerCase():e.activity.text;if(o.startsWith("hello"))return void(yield e.sendActivity("Oh, hello to you as well!"));if(o.startsWith("help")){const t=yield this.dialogs.createContext(e);yield t.beginDialog("help")}else yield e.sendActivity("I'm terribly sorry, but my master hasn't trained me to do anything yet...")}return this.conversationState.saveChanges(e)}))},this.activityProc.conversationUpdateActivityHandler={onConversationUpdateActivity:e=>r(this,void 0,void 0,(function*(){if(e.activity.membersAdded&&0!==e.activity.membersAdded.length)for(const t in e.activity.membersAdded)if(e.activity.membersAdded[t].id===e.activity.recipient.id){const t=a.CardFactory.adaptiveCard(l.default);yield e.sendActivity({attachments:[t]})}}))},this.activityProc.messageReactionActivityHandler={onMessageReaction:e=>r(this,void 0,void 0,(function*(){const t=e.activity.reactionsAdded;t&&t[0]&&(yield e.sendActivity({textFormat:"xml",text:`That was an interesting reaction (<b>${t[0].type}</b>)`}))}))}}onTurn(e){return r(this,void 0,void 0,(function*(){yield this.activityProc.processIncomingActivity(e)}))}};n([i.MessageExtensionDeclaration("csrDemoMessageExtension")],f.prototype,"_csrDemoMessageExtension",void 0),f=n([i.BotDeclaration("/api/messages",new a.MemoryStorage,process.env.MICROSOFT_APP_ID,process.env.MICROSOFT_APP_PASSWORD),i.PreventIframe("/csrDemoBot/aboutCsrDemoBo.html")],f),t.CsrDemoBot=f},function(e,t,o){"use strict";var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function s(e){try{a(n.next(e))}catch(e){i(e)}}function c(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){e.done?r(e.value):new o((function(t){t(e.value)})).then(s,c)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=o(3);class i extends r.Dialog{constructor(e){super(e)}beginDialog(e,t){return n(this,void 0,void 0,(function*(){return e.context.sendActivity("I'm just a friendly but rather stupid bot, and right now I don't have any valuable help for you!"),yield e.endDialog()}))}}t.default=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(16);t.default=n},function(e){e.exports={$schema:"http://adaptivecards.io/schemas/adaptive-card.json",type:"AdaptiveCard",version:"1.0",body:[{type:"Image",url:"https://csr.azurewebsites.net/assets/icon.png",size:"stretch"},{type:"TextBlock",spacing:"medium",size:"default",weight:"bolder",text:"Welcome to CSRDemo",wrap:!0,maxLines:0},{type:"TextBlock",size:"default",isSubtle:!0,text:"Hello, nice to meet you!",wrap:!0,maxLines:0}],actions:[{type:"Action.OpenUrl",title:"Learn more about Yo Teams",url:"https://aka.ms/yoteams"},{type:"Action.OpenUrl",title:"CSRDemo",url:"https://csr.azurewebsites.net"}]}},function(e,t,o){"use strict";var n=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s},r=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function s(e){try{a(n.next(e))}catch(e){i(e)}}function c(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){e.done?r(e.value):new o((function(t){t(e.value)})).then(s,c)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=o(1),s=o(0),c=o(2),a=i("msteams");let u=class{onQuery(e,t){return r(this,void 0,void 0,(function*(){const e=c.CardFactory.adaptiveCard({type:"AdaptiveCard",body:[{type:"TextBlock",size:"Large",text:"Headline"},{type:"TextBlock",text:"Description"},{type:"Image",url:`https://${process.env.HOSTNAME}/assets/icon.png`}],actions:[{type:"Action.Submit",title:"More details",data:{action:"moreDetails",id:"1234-5678"}}],$schema:"http://adaptivecards.io/schemas/adaptive-card.json",version:"1.0"}),o={contentType:"application/vnd.microsoft.card.thumbnail",content:{title:"Headline",text:"Description",images:[{url:`https://${process.env.HOSTNAME}/assets/icon.png`}]}};return t.parameters&&t.parameters[0]&&t.parameters[0].name,Promise.resolve({type:"result",attachmentLayout:"list",attachments:[Object.assign({},e,{preview:o})]})}))}onCardButtonClicked(e,t){return r(this,void 0,void 0,(function*(){return"moreDetails"===t.action&&a(`I got this ${t.id}`),Promise.resolve()}))}onQuerySettingsUrl(e){return r(this,void 0,void 0,(function*(){return Promise.resolve({title:"CSRDemo Message Extension Configuration",value:`https://${process.env.HOSTNAME}/csrDemoMessageExtension/config.html`})}))}onSettings(e){return r(this,void 0,void 0,(function*(){const t=e.activity.value.state;return a(`New setting: ${t}`),Promise.resolve()}))}};u=n([s.PreventIframe("/csrDemoMessageExtension/config.html")],u),t.default=u},function(e,t){e.exports=require("botbuilder-teams")},function(e,t,o){"use strict";var n=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(t,"__esModule",{value:!0});const r=o(2),i=o(20);let s=class{constructor(){}requestHandler(e,t,o){const n=e.body,s={type:r.ActivityTypes.Message},c=process.env.SECURITY_TOKEN;if(c&&c.length>0){const t=e.headers.authorization,o=Buffer.from(e.rawBody,"utf8"),r="HMAC "+i.createHmac("sha256",new Buffer(c,"base64")).update(o).digest("base64");s.text=r===t?`Echo ${n.text}`:"Error: message sender cannot be verified"}else s.text="Error: outgoing webhook is not configured with a security token";t.send(JSON.stringify(s))}};s=n([o(0).OutgoingWebhookDeclaration("/api/webhook")],s),t.CsrDemoOutgoingWebhook=s},function(e,t){e.exports=require("crypto")},function(e,t,o){"use strict";var n=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s);return i>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(t,"__esModule",{value:!0});const r=o(22),i=o(0),s=o(23),c=o(1)("msteams");let a=class{constructor(){this.connectors=new s("connectors",!0,!1)}Connect(e){"myAppsState"===e.body.state&&this.connectors.push("/connectors[]",{appType:e.body.appType,color:e.body.color,existing:!0,groupName:e.body.groupName,user:e.body.user,webhookUrl:e.body.webhookUrl})}Ping(e){try{this.connectors.push("/connectors",this.connectors.getData("/connectors").filter(e=>e.existing))}catch(e){if(e.name&&"DataError"===e.name)return[];throw e}return this.connectors.getData("/connectors").map((e,t)=>new Promise((o,n)=>{const i={title:"Sample Connector",text:"This is a sample Office 365 Connector",sections:[{activityTitle:"Ping",activityText:"Sample ping ",activityImage:`https://${process.env.HOSTNAME}/assets/icon.png`,facts:[{name:"Generator",value:"teams"},{name:"Created by",value:e.user}]}],potentialAction:[{"@context":"http://schema.org","@type":"ViewAction",name:"Yo Teams",target:["http://aka.ms/yoteams"]}]};c(`Sending card to ${e.webhookUrl}`),r({method:"POST",uri:decodeURI(e.webhookUrl),headers:{"content-type":"application/json"},body:JSON.stringify(i)},(e,r,i)=>{c(`Response from Connector endpoint is: ${r.statusCode}`),e?n(e):(410===r.statusCode&&this.connectors.push(`/connectors[${t}]/existing`,!1),o())})}))}};a=n([i.ConnectorDeclaration("/api/connector/connect","/api/connector/ping"),i.PreventIframe("/csrDemoConnector/config.html")],a),t.CsrDemoConnector=a},function(e,t){e.exports=require("request")},function(e,t){e.exports=require("node-json-db")}]);
//# sourceMappingURL=server.js.map